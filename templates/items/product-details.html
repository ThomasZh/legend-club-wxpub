<!-- 供应商所卖商品 @2017/05/25 -->
<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>产品详情</title>
    <meta name="description" content="Material Design Mobile Template">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Icons -->
    <link href="{{ static_url('shuttle/css/ionicons.min.css') }}" media="all" rel="stylesheet" type="text/css">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ static_url('weui/css/weui.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('weui/css/jquery-weui.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/animate.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/materialize.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/swipebox.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/swiper.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/normalize.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/main.css') }}">
    <!-- <link rel="stylesheet" href="{{ static_url('css/z-self.css') }}"> -->
    <script src="{{ static_url('shuttle/js/vendor/modernizr-2.7.1.min.js') }}"></script>
    <style media="screen">
    .m-spinner{
      border: 1px solid #EAE8E8;
      border-radius: 1px;
      display: block;
      float: left;
      overflow: hidden;
    }
    .m-spinner > a{
      float: left;
      width: 2rem;
      height: 2rem;
      line-height: .62rem;
      text-align: center;
      font-weight: bold;
      color: #666;
      letter-spacing: 0;
      background-color: #F8F8F8;
      padding: 0.7rem;
    }
    .m-spinner > a:first-child:after{
      content: '-';
    }
    .m-spinner > a:last-child:after{
      content: '+';
    }
    .m-spinner > input{
      letter-spacing: 0;
      float: left;
      width: 2rem;
      height: 2rem;
      text-align: center;
      color: #666;
      border: none;
      font-size: 1.26rem;
      margin: 0;
      padding-left:0;
    }
    .floating-button{
      position: fixed;
      right:2rem;
      bottom: 5rem;
      z-index: 999;
    }
    .mark{
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: block;
      border-radius: 50%;
      background-color: #ef4018;
      width: 1.5rem;
      height: 1.5rem;
      line-height: 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
    }
    </style>
  </head>
  <body>
    <!-- Main Container -->
    <div id="main" class="main">
      <!-- End of Toolbar -->

      <!-- Page Contents -->
      <div class="animated fadeinup">

        <!-- Hero Header -->
        <div class="hero-header animated fadein">
          <!-- Slider -->
          <div class="swiper-container swiper-slider">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <a href="#"><img src="{{ item['img'] }}" alt=""></a>
              </div>
              <div class="swiper-slide">
                <a href="#"><img src="{{ item['img'] }}" alt=""></a>
              </div>
              <div class="swiper-slide">
                <a href="#"><img src="{{ item['img'] }}" alt=""></a>
              </div>
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
          </div>
          <!-- End of Slider -->
        </div>

        <!-- Product Title -->
        <div class="center-align p-20">
          <!-- <span class="small grey-text">科技产品</span> -->
          <h3 class="m-0"><strong>{{ item['title'] }}</strong></h3>
          <h4></h4>
        </div>

        <!-- Prduct Description -->
        <div class="product-description">
          <ul class="tabs">
            <li class="tab col s3"><a class="active" href="#product1">商品介绍</a></li>
            <li class="tab col s3"><a href="#product2">商品评价</a></li>
          </ul>

          <div id="product1" class="p-20">
            <p class="text-flow" id="J_show">{{ article['paragraphs'] }}</p>
          </div>
          <div id="product2" class="p-20">
            <p class="text-flow">这里是评价列表。。。。</p>
          </div>
        </div>

        <div class="product-variation">
          <h5><strong>规格:</strong></h5>
            {% for i in range(len(item['base_fee_template'])) %}
            <div style="margin-bottom:10px;">
              <p>
                <input name="fee_template" type="radio" id="test{{i}}" value="{{ item['base_fee_template'][i]['_id'] }}" />
                <label for="test{{i}}">{{ item['base_fee_template'][i]['name'] }}:{{ item['base_fee_template'][i]['fee'] }}元</label>
              </p>
            </div>
            {% end %}
            <input type="hidden" name="fee_template_id" id="tem_input">
        </div>

        <div class="product-variation">
          <h5><strong>数量:</strong></h5>
            <div style="margin-bottom:10px;">
              <p style="padding-left:3rem; overflow:hidden;">
                <span class="m-spinner" id="J_spinner">
                  <a href="javascript:;" class="J_Del"></a>
                  <input type="number" id="J_input" name="product_num" class="J_input" min="1" value="1">
                  <a href="javascript:;" class="J_Add"></a>
                </span>
              </p>
            </div>
        </div>


          <div class="product-variation">
            <a id="f_btn" class="waves-effect waves-light btn-large modal-trigger accent-color block m-20" href="javascript:void(0)">添加到购物车</a>
          </div>
      <!-- 购物车 -->
        <div class="floating-button animated bouncein delay-3">
          <a id="shop-car" href="/bf/wx/vendors/{{ club_id }}/items/cart" class="btn-floating btn-large waves-effect waves-light accent-color btn z-depth-1">
            <span class=""></span><i class="ion-ios-cart"></i>
          </a>
        </div>
        <!-- Footer -->
        <footer class="page-footer primary-color">
          <div class="footer-copyright">
            <div class="container center">
              <span>Made with <i class="ion-ios-heart"></i> by Thomas</span>
            </div>
          </div>
        </footer>


      </div>
      <!-- End of Page Contents -->
    </div>
    <!-- End of Main Container -->

    <!-- Scripts -->
    <script src="{{ static_url('shuttle/js/vendor/modernizr-2.7.1.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery-2.1.0.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/helper.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/HeadsUp.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.smoothState.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/chart.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.mixitup.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.swipebox.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/masonry.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/swiper.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/materialize.min.js') }}"></script>
    <script src="{{ static_url('shuttle-master/product.js') }}"></script>
    <script src="{{ static_url('weui/js/jquery-weui.min.js') }}"></script>
    <script type="text/javascript">
    $(function(){

      function removeHtmlTab(tab) {
       return tab.replace(/<\/?[^>]*>/g,'');//删除所有HTML标签
     };

     var paragraphs = $("#J_show").text();
         paragraphs = removeHtmlTab(paragraphs)
      $("#J_show").text(paragraphs);

      $(".J_Del").on("click",function(){
        var num = $("#J_input").val();
          if(num < 2){
            num = 1;
            $("#J_input").val(num);
          }else{
            num--;
            $("#J_input").val(num);
          }
      });
      $(".J_Add").on("click",function(){
        var num = $("#J_input").val();
          num++;
          $("#J_input").val(num);
      });

      // 添加购物车数量
        var num = {{ cart_goods_num }};
        // console.log(num);
        if(num>0){
            $("#shop-car span:first-child").addClass('mark');
            $("#shop-car span:first-child").html(num);
        }else{
          $("#shop-car span:first-child").removeClass('mark');
        }

      $("#f_btn").on('click',function(event){
        var tem_id = $("input[name='fee_template']:checked").val();
        var item_id = "{{ item_id }}";
        var product_num = $("#J_input").val();
        if(typeof(tem_id) == 'undefined'){
           event.preventDefault();
           $.alert('','请选择商品规格！')
        }else{
          var data = [{"item_id":item_id, "fee_template_id":tem_id, "quantity":product_num}];
          var json = JSON.stringify(data);
          // console.log(json);
          $.ajax({
            type: "POST",
            url: "{{ api_domain }}/api/clubs/{{club_id}}/cart/items",
            data: json,
            dataType: "json",
            headers: {"Authorization":"Bearer {{access_token}}"},
            contentType: 'application/json',
            success: function(data, status, xhr) {

              var cart_goods_num = $("#shop-car span:first-child").html();
              if(cart_goods_num == ''){
                $("#shop-car span:first-child").addClass('mark');
                cart_goods_num = 0;
              }else{

              }
                var cart_num = parseInt(cart_goods_num) + parseInt(product_num);
                  $("#shop-car span:first-child").html(cart_num);
                  // console.log("ok");
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                console.log("error");
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        }
      })
    });
    </script>
  </body>
</html>
