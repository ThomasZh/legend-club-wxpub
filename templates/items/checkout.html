<!-- 供应商所卖商品 @2017/05/25 -->
<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>商品结算</title>
    <meta name="description" content="Material Design Mobile Template">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Icons -->
    <link href="{{ static_url('shuttle/css/ionicons.min.css') }}" media="all" rel="stylesheet" type="text/css">
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ static_url('weui/css/weui.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('weui/css/jquery-weui.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/animate.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/materialize.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/swipebox.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/swiper.min.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/normalize.css') }}">
    <link rel="stylesheet" href="{{ static_url('shuttle/css/main.css') }}">
    <link rel="stylesheet" href="{{ static_url('css/z-self.css') }}">
    <script src="{{ static_url('shuttle/js/vendor/modernizr-2.7.1.min.js') }}"></script>
  </head>
  <body>
    <!-- Main Container -->
    <div id="main" class="main">

      <!-- Page Contents -->
      <div class="animated fadeinup">

        <!-- Order Recap -->
        <ul class="collapsible checkout-header animated fadeindown delay-2" data-collapsible="accordion">
          <li>
            <div class="collapsible-header">
              设置收获信息
               <!-- <p>周<span>15901156656</span></p>
               <p>北京市朝阳区望京东金辉大厦</p> -->
            </div>

            <div class="collapsible-body z-depth-1">
              <!-- <h4 class="shipping-address">地址一</h4> -->
              <form action="" action="post" class="Z_form">
                <div class="input-field">
                  <input id="first_name" type="text" class="validate">
                  <label for="first_name">姓名</label>
                </div>
                <div class="input-field">
                  <input id="phone" type="number" class="validate">
                  <label for="phone">手机号</label>
                </div>
                <div class="input-field">
                  <input id="address" type="text" class="validate">
                  <label for="address">地址</label>
                </div>
                <a class="waves-effect waves-light btn" style="margin-left:50%;">添加</a>
              </form>
            </div>
          </li>
        </ul>

        <!-- 购物车商品列表 -->
        {% for item in items %}
          <div class="product_list">
            <ul class="collection">
              <li class="list-item">
                  <div class="list-item-inner">
                      <a href="#" class="list-item-pic">
                          <img src="{{ item['img'] }}">
                      </a>
                      <div class="list-item-info">
                          <a href="#" class="meta">
                              <h4 class="title">{{ item['title'] }}</h4>
                              <p class="single-line">
                                  <span>{{ item['fee_template_name'] }}</span>
                              </p>
                          </a>
                          <div class="list-item-spinner">
                            <span class="m-spinner" id="J_spinner">
                              <a href="javascript:;" class="J_Del" data_dele_id="{{ item['_id'] }}"></a>
                              <input type="number" id="J_input" name="product_num" class="J_input" min="1" value="{{ item['quantity'] }}">
                              <a href="javascript:;" class="J_Add" data_dele_id="{{ item['_id'] }}"></a>
                            </span>
                            <a href="javascript:;" class="close cart-info-delete" data_dele_id="{{ item['_id'] }}">
                              <i class="iconfont icon-close ion-ios-trash-outline"></i>
                            </a>
                          </div>
                          <a href="#" class="price">
                              ￥<span class="original-price">{{ item['fee'] }}</span>
                              <!-- <del>￥299</del> -->
                          </a>
                      </div>
                  </div>
              </li>
            </ul>
          </div>
        {% end %}
        <!-- Form Inputs -->
        <!-- 占位 -->
        <div class="z-position"></div>
        <!-- Footer -->
        <footer class="page-footer">
          <div class="footer-total-price">
            合计：￥<span>0.00</span>
          </div>
          <div class="footer-pay">
            <button class="footer-pay-btn">下单</button>
          </div>
        </footer>

      </div>
      <!-- End of Page Contents -->
    </div>
    <!-- End of Main Container -->

    <!-- Scripts -->

    <script src="{{ static_url('shuttle/js/vendor/modernizr-2.7.1.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery-2.1.0.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/helper.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/HeadsUp.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.smoothState.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/chart.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.mixitup.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/jquery.swipebox.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/masonry.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/swiper.min.js') }}"></script>
    <script src="{{ static_url('shuttle/js/vendor/materialize.min.js') }}"></script>
    <script src="{{ static_url('weui/js/jquery-weui.min.js') }}"></script>
    <script type="text/javascript">
    $(function(){
      $(document).on("click",".J_Del",function(){
        var num = $(this).next().val();
          if(num < 2){
            num = 1;
            $(this).next().val(num);
          }else{
            num--;
            var _id = $(this).attr("data_dele_id");
            // console.log(_id);
            data = {"quantity":num}
            _json = JSON.stringify(data);
            var _this = $(this);
            $.ajax({
              type: "POST",
              url: "{{api_domain}}/api/clubs/{{club_id}}/cart/items/"+_id,
              data:_json,
              headers: {
                "Authorization": "Bearer {{ access_token }}"
              },
              contentType: 'application/json',
              success: function(data, status, xhr) {
                var data = JSON.parse(data);
                var quantity = data.data.quantity;
                _this.next().val(quantity);
                getTotal();
              }
            });
          }
      });

      $(document).on("click",".J_Add",function(){
        var num = $(this).prev().val();
            num++;
        var _id = $(this).attr("data_dele_id");

          data = {"quantity":num}
          _json = JSON.stringify(data);
          // console.log(_json);
          var _this = $(this);
          $.ajax({
            type: "POST",
            url: "{{api_domain}}/api/clubs/{{club_id}}/cart/items/"+_id,
            data:_json,
            headers: {
              "Authorization": "Bearer {{ access_token }}"
            },
            contentType: 'application/json',
            success: function(data, status, xhr) {
              // console.log(data);
              var data = JSON.parse(data);
              var quantity = data.data.quantity;
              _this.prev().val(quantity);
              getTotal();
            }
          });

      });
      // 计算总金额
      function getTotal(){
        var num = $(".list-item-info").length;
        var total_price=0;
        for(var i=0;i<num;i++){
          var one_price = $(".list-item-info").eq(i).find(".original-price").html();
          var quantity = $(".list-item-info").eq(i).find(".J_input").val();
          var one_total = one_price*quantity;
              total_price += parseFloat(one_total);
        }
          $(".footer-total-price").children().html(total_price.toFixed(2));
      };
      getTotal();

      $(document).on('click','.cart-info-delete',function(){
        var _id = $(this).attr('data_dele_id');
        $.confirm("确定删除该商品吗?", function() {
            $.ajax({
              type: "DELETE",
              url: "{{api_domain}}/api/clubs/{{club_id}}/cart/items/"+_id,
              headers: {
                "Authorization": "Bearer {{ access_token }}"
              },
              contentType: 'application/json',
              success: function(data, status, xhr) {
                location.reload();
              }
            });
          }, function() {
          //点击取消后的回调函数
          });
      });

    });
    </script>
  </body>
</html>
